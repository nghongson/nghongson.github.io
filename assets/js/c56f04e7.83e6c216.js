"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1595],{69646:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>t,metadata:()=>c,toc:()=>l});var i=s(74848),o=s(28453);const t={},r="Session",c={id:"architect/session",title:"Session",description:"What is session?",source:"@site/docs/architect/session.md",sourceDirName:"architect",slug:"/architect/session",permalink:"/docs/architect/session",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"index",permalink:"/docs/architect/notifications/"},next:{title:"Golang",permalink:"/docs/category/golang"}},a={},l=[{value:"What is session?",id:"What-is-session",level:2},{value:"Session &amp; Cookies",id:"Session--Cookies",level:2},{value:"Session-Based vs. Token-Based Authentication",id:"Session-Based-vs-Token-Based-Authentication",level:2},{value:"Express session",id:"Express-session",level:3},{value:"NestJs",id:"NestJs",level:3},{value:"Gin session",id:"Gin-session",level:3},{value:"Go fiber session",id:"Go-fiber-session",level:3},{value:"Ref:",id:"Ref",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"Session",children:"Session"}),"\n",(0,i.jsx)(e.h2,{id:"What-is-session",children:"What is session?"}),"\n",(0,i.jsx)(e.h2,{id:"Session--Cookies",children:"Session & Cookies"}),"\n",(0,i.jsx)(e.p,{children:"Session server side\nCookie client side (browser)"}),"\n",(0,i.jsx)(e.h2,{id:"Session-Based-vs-Token-Based-Authentication",children:"Session-Based vs. Token-Based Authentication"}),"\n",(0,i.jsx)(e.h3,{id:"Express-session",children:"Express session"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"import * as session from 'express-session';\n\nvar app = express()\napp.set('trust proxy', 1) // trust first proxy\napp.use(session({\n  secret: 'keyboard cat',\n  resave: false,\n  saveUninitialized: true,\n  cookie: { secure: true },\n}))\napp.use(function (req, res, next) {\n  if (!req.session.views) {\n    req.session.views = {}\n  }\n\n  // get the url pathname\n  var pathname = parseurl(req).pathname\n\n  // count the views\n  req.session.views[pathname] = (req.session.views[pathname] || 0) + 1\n\n  next()\n})\n"})}),"\n",(0,i.jsx)(e.p,{children:"Redis"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'npm install redis connect-redis express-session\n\nimport RedisStore from "connect-redis"\nimport session from "express-session"\nimport {createClient} from "redis"\n\n// Initialize client.\nlet redisClient = createClient()\nredisClient.connect().catch(console.error)\n\n// Initialize store.\nlet redisStore = new RedisStore({\n  client: redisClient,\n  prefix: "myapp:",\n})\n\n// Initialize session storage.\napp.use(\n  session({\n    store: redisStore,\n    resave: false, // required: force lightweight session keep alive (touch)\n    saveUninitialized: false, // recommended: only save session when data exists\n    secret: "keyboard cat",\n  }),\n)\n\n'})}),"\n",(0,i.jsx)(e.h3,{id:"NestJs",children:"NestJs"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"import * as session from 'express-session';\n// somewhere in your initialization file\napp.use(\n  session({\n    secret: 'my-secret',\n    resave: false,\n    saveUninitialized: false,\n    store: new redisStore({...}),\n  }),\n);\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"@Get()\nfindAll(@Req() request: Request) {\n  request.session.visits = request.session.visits ? request.session.visits + 1 : 1;\n}\n@Get()\nfindAll(@Session() session: Record<string, any>) {\n  session.visits = session.visits ? session.visits + 1 : 1;\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"Gin-session",children:"Gin session"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'package main\n\nimport (\n  "github.com/gin-contrib/sessions"\n  "github.com/gin-contrib/sessions/cookie"\n  "github.com/gin-gonic/gin"\n)\n\nfunc main() {\n  r := gin.Default()\n  store := cookie.NewStore([]byte("secret"))\n  r.Use(sessions.Sessions("mysession", store))\n\n  r.GET("/hello", func(c *gin.Context) {\n    session := sessions.Default(c)\n\n    if session.Get("hello") != "world" {\n      session.Set("hello", "world")\n      session.Save()\n    }\n\n    c.JSON(200, gin.H{"hello": session.Get("hello")})\n  })\n  r.Run(":8000")\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"cookie-based"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'package main\n\nimport (\n  "github.com/gin-contrib/sessions"\n  "github.com/gin-contrib/sessions/cookie"\n  "github.com/gin-gonic/gin"\n)\n\nfunc main() {\n  r := gin.Default()\n  store := cookie.NewStore([]byte("secret"))\n  r.Use(sessions.Sessions("mysession", store))\n\n  r.GET("/incr", func(c *gin.Context) {\n    session := sessions.Default(c)\n    var count int\n    v := session.Get("count")\n    if v == nil {\n      count = 0\n    } else {\n      count = v.(int)\n      count++\n    }\n    session.Set("count", count)\n    session.Save()\n    c.JSON(200, gin.H{"count": count})\n  })\n  r.Run(":8000")\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Redis"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'package main\n\nimport (\n  "github.com/gin-contrib/sessions"\n  "github.com/gin-contrib/sessions/redis"\n  "github.com/gin-gonic/gin"\n)\n\nfunc main() {\n  r := gin.Default()\n  store, _ := redis.NewStore(10, "tcp", "localhost:6379", "", []byte("secret"))\n  r.Use(sessions.Sessions("mysession", store))\n\n  r.GET("/incr", func(c *gin.Context) {\n    session := sessions.Default(c)\n    var count int\n    v := session.Get("count")\n    if v == nil {\n      count = 0\n    } else {\n      count = v.(int)\n      count++\n    }\n    session.Set("count", count)\n    session.Save()\n    c.JSON(200, gin.H{"count": count})\n  })\n  r.Run(":8000")\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"Go-fiber-session",children:"Go fiber session"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'import (\n  "github.com/gofiber/fiber/v3"\n  "github.com/gofiber/fiber/v3/middleware/session"\n)\n\n// Initialize default config\n// This stores all of your app\'s sessions\nstore := session.New()\n\napp.Get("/", func(c fiber.Ctx) error {\n    // Get session from storage\n    sess, err := store.Get(c)\n    if err != nil {\n        panic(err)\n    }\n\n    // Get value\n    name := sess.Get("name")\n\n    // Set key/value\n    sess.Set("name", "john")\n\n    // Get all Keys\n    keys := sess.Keys()\n\n    // Delete key\n    sess.Delete("name")\n\n    // Destroy session\n    if err := sess.Destroy(); err != nil {\n        panic(err)\n    }\n\n\t// Sets a specific expiration for this session\n\tsess.SetExpiry(time.Second * 2)\n\n    // Save session\n    if err := sess.Save(); err != nil {\n\t\tpanic(err)\n\t}\n\n\treturn c.SendString(fmt.Sprintf("Welcome %v", name))\n})\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'Default Config\nvar ConfigDefault = Config{\n\tExpiration:   24 * time.Hour,\n\tKeyLookup:    "cookie:session_id",\n\tKeyGenerator: utils.UUIDv4,\n\tsource:       "cookie",\n\tsessionName:  "session_id",\n}\n\n\nConstants\nconst (\n\tSourceCookie   Source = "cookie"\n\tSourceHeader   Source = "header"\n\tSourceURLQuery Source = "query"\n)\n'})}),"\n",(0,i.jsx)(e.p,{children:"Custom Storage/Database"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'import "github.com/gofiber/storage/redis/v3"\n// Initialize default config\nstorage := redis.New()\n\n// Initialize custom config\nstorage := redis.New(redis.Config{\n\tHost:      "127.0.0.1",\n\tPort:      6379,\n\tUsername:  "",\n\tPassword:  "",\n\tDatabase:  0,\n\tReset:     false,\n\tTLSConfig: nil,\n\tPoolSize:  10 * runtime.GOMAXPROCS(0),\n})\nstore := session.New(session.Config{\n\tStorage: storage,\n})\n'})}),"\n",(0,i.jsx)(e.h2,{id:"Ref",children:"Ref:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"http://www.senchalabs.org/connect/session.html",children:"session"})}),"\n",(0,i.jsx)(e.li,{}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>r,x:()=>c});var i=s(96540);const o={},t=i.createContext(o);function r(n){const e=i.useContext(t);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:r(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);