"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2620],{74558:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>h,toc:()=>s});var a=c(74848),t=c(28453);const r={},i="GraphQL Cache",h={id:"architect/api/GraphQL Cache",title:"GraphQL Cache",description:"- caching in graphql",source:"@site/docs/architect/api/GraphQL Cache.md",sourceDirName:"architect/api",slug:"/architect/api/GraphQL Cache",permalink:"/docs/architect/api/GraphQL Cache",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"GraphQL Best Practices",permalink:"/docs/architect/api/GraphQL Best Practices"},next:{title:"Graphql",permalink:"/docs/architect/api/GraphQL"}},l={},s=[{value:"Strategies for GraphQL caching",id:"Strategies-for-GraphQL-caching",level:2},{value:"Client cache side",id:"Client-cache-side",level:2},{value:"Reading and writing to the cache",id:"Reading-and-writing-to-the-cache",level:3},{value:"ApolloClient InMemoryCache",id:"ApolloClient-InMemoryCache",level:3},{value:"Server cache side",id:"Server-cache-side",level:2},{value:"Setting cache control for a type",id:"Setting-cache-control-for-a-type",level:3},{value:"Caching GET requests",id:"Caching-GET-requests",level:3},{value:"A concept Document Caching <code>urql</code>",id:"A-concept-Document-Caching-urql",level:2}];function o(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"GraphQL-Cache",children:"GraphQL Cache"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://daily.dev/blog/caching-in-graphql",children:"caching in graphql"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"Strategies-for-GraphQL-caching",children:"Strategies for GraphQL caching"}),"\n",(0,a.jsx)(n.h2,{id:"Client-cache-side",children:"Client cache side"}),"\n",(0,a.jsx)(n.h3,{id:"Reading-and-writing-to-the-cache",children:"Reading and writing to the cache"}),"\n",(0,a.jsx)(n.h3,{id:"ApolloClient-InMemoryCache",children:"ApolloClient InMemoryCache"}),"\n",(0,a.jsx)(n.h2,{id:"Server-cache-side",children:"Server cache side"}),"\n",(0,a.jsx)(n.h3,{id:"Setting-cache-control-for-a-type",children:"Setting cache control for a type"}),"\n",(0,a.jsx)(n.p,{children:"cache hints to the GraphQL schema"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:" type Author @cacheControl(maxAge: 60) {\n  id: Int\n  firstName: String\n  lastName: String\n  posts: [Post] @cacheControl(maxAge: 180)\n}\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { ApolloServerPluginCacheControl } from '@apollo/server/plugin/cacheControl';\n\nconst server = new ApolloServer({\n  typeDefs,\n  resolvers,\n  // The max age is calculated in seconds\n  plugins: [ApolloServerPluginCacheControl({ defaultMaxAge: 5 })],\n});\n"})}),"\n",(0,a.jsx)(n.h3,{id:"Caching-GET-requests",children:"Caching GET requests"}),"\n",(0,a.jsx)(n.p,{children:"Use in CDN"}),"\n",(0,a.jsx)(n.p,{children:"persisted query: Hash SHA256"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl --get http://localhost:4000/graphql \\\n  --header \'content-type: application/json\' \\\n  --data-urlencode \'extensions={"persistedQuery":{"version":1,"sha256Hash":"ecf4edb46db40b5132295c0291d62fb65d6759a9eedfa4d5d612dd5ec54a6b38"}}\'\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Send\xa0both the\xa0query\xa0string\xa0",(0,a.jsx)(n.em,{children:"and"}),"\xa0its hash,"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl --get http://localhost:4000/graphql \\\n  --header \'content-type: application/json\' \\\n  --data-urlencode \'query={__typename}\' \\\n  --data-urlencode \'extensions={"persistedQuery":{"version":1,"sha256Hash":"ecf4edb46db40b5132295c0291d62fb65d6759a9eedfa4d5d612dd5ec54a6b38"}}\'\n'})}),"\n",(0,a.jsxs)(n.h2,{id:"A-concept-Document-Caching-urql",children:["A concept Document Caching ",(0,a.jsx)(n.code,{children:"urql"})]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},28453:(e,n,c)=>{c.d(n,{R:()=>i,x:()=>h});var a=c(96540);const t={},r=a.createContext(t);function i(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function h(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);