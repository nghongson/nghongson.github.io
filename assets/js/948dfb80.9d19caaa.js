"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1964],{52621:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>d,toc:()=>o});var t=n(74848),a=n(28453);const i={},s="Middleware",d={id:"nextjs/Middleware",title:"Middleware",description:"Use Cases",source:"@site/docs/nextjs/Middleware.md",sourceDirName:"nextjs",slug:"/nextjs/Middleware",permalink:"/docs/nextjs/Middleware",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lazy Loading",permalink:"/docs/nextjs/Lazy Loading"},next:{title:"Route Handler",permalink:"/docs/nextjs/Route Handler"}},l={},o=[{value:"Use Cases",id:"Use-Cases",level:2},{value:"Middleware may not be the optimal approach",id:"Middleware-may-not-be-the-optimal-approach",level:2},{value:"Example middleware.ts",id:"Example-middlewarets",level:3},{value:"wrapper-middleware.ts",id:"wrapper-middlewarets",level:3},{value:"Redirects bloom filter",id:"Redirects-bloom-filter",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{id:"Middleware",children:"Middleware"}),"\n",(0,t.jsx)(r.h2,{id:"Use-Cases",children:"Use Cases"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Authentication and Authorization"}),"\n",(0,t.jsx)(r.li,{children:"Server-Side Redirects: Redirect users at the server level based on certain conditions (e.g., locale, user role)."}),"\n",(0,t.jsx)(r.li,{children:"Path Rewriting: Support A/B testing, feature rollouts, or legacy paths by dynamically rewriting paths to API routes or pages based on request properties."}),"\n",(0,t.jsx)(r.li,{children:"Bot Detection: Protect your resources by detecting and blocking bot traffic."}),"\n",(0,t.jsx)(r.li,{children:"Logging and Analytics: Capture and analyze request data for insights before processing by the page or API."}),"\n",(0,t.jsx)(r.li,{children:"Feature Flagging: Enable or disable features dynamically for seamless feature rollouts or testing."}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"Middleware-may-not-be-the-optimal-approach",children:"Middleware may not be the optimal approach"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Complex Data Fetching and Manipulation: Middleware is not designed for direct data fetching or manipulation, this should be done within Route Handlers or server-side utilities instead."}),"\n",(0,t.jsx)(r.li,{children:"Heavy Computational Tasks"}),"\n",(0,t.jsx)(r.li,{children:"Extensive Session Management (Middleware should just management basic session)"}),"\n",(0,t.jsx)(r.li,{children:"Direct Database Operations: Performing direct database operations within Middleware is not recommended. Database interactions should done within Route Handlers or server-side utilities."}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"Example-middlewarets",children:"Example middleware.ts"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:'import { NextResponse } from "next/server";\nimport type { NextRequest } from "next/server";\n\n// This function can be marked `async` if using `await` inside\nexport function middleware(request: NextRequest) {\n  return NextResponse.redirect(new URL("/home", request.url));\n}\n\n// See "Matching Paths" below to learn more\nexport const config = {\n  matcher: "/about/:path*",\n};\n'})}),"\n",(0,t.jsx)(r.h3,{id:"wrapper-middlewarets",children:"wrapper-middleware.ts"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:'import { NextMiddleware } from "next/server";\n\nexport type WrapMiddlewareParams = {\n  middleware?: NextMiddleware;\n};\n\nexport interface WrapMiddleware {\n  (params: AuthMiddlewareParams): NextMiddleware;\n}\n\nconst createWrapperMiddleware: WrapMiddleware = (\n  params: WrapMiddlewareParams,\n) => {\n  const { middleware } = params;\n  return async function middlewareWrapper(\n    ...args\n  ): Promise<NextMiddlewareResult> {\n    const [request, event] = args;\n    const { pathname } = request.nextUrl;\n\n    if (middleware) {\n      return middleware(...args);\n    }\n  };\n};\nexport { createAuthMiddleware };\n'})}),"\n",(0,t.jsx)(r.h2,{id:"Redirects-bloom-filter",children:"Redirects bloom filter"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"\nimport { ScalableBloomFilter } from 'bloom-filters'\n"})})]})}function p(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>d});var t=n(96540);const a={},i=t.createContext(a);function s(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);